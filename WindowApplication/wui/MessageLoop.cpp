/////////////////////////////////////////////////////////////////////////////
//===========================================================================
#include "pch.hpp"

//===========================================================================
#include "wui.hpp"





/////////////////////////////////////////////////////////////////////////////
//===========================================================================
namespace wui
{





/////////////////////////////////////////////////////////////////////////////
//===========================================================================
void MessageLoop::addIdleHandler(std::function<void(void)> handler)
{
	_idleHandlers.push_back(handler);
}

//===========================================================================
void MessageLoop::run(void)
{
	//-----------------------------------------------------------------------
	MSG msg;
	BOOL rv;


	do
	{
		rv = ::PeekMessageW(&msg, HWND{}, 0, 0, PM_REMOVE);
		if (rv != 0)
		{
			::TranslateMessage(&msg);
			::DispatchMessageW(&msg);
		}
		else
		{
			onIdle();
		}
	} while (msg.message != WM_QUIT);
}

void MessageLoop::onIdle(void)
{
	for (auto& handler : _idleHandlers)
	{
		handler();
	}
}





/////////////////////////////////////////////////////////////////////////////
//===========================================================================
}




